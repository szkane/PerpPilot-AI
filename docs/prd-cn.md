# PerpPilot-AI 产品需求文档 (PRD)

### 1. 产品概述

#### 1.1 产品名称

PerpPilot-AI - 永续合约杠杆倍率 AI 分析助手 (Perpetual Futures Leverage Ratio AI Analysis Assistant)

#### 1.2 产品定位

一款由 AI 驱动的、风险优先的交易策略规划工具，帮助合约小白新手合理使用杠杆倍率，并理解其交易计划的内在风险。

#### 1.3 目标用户

- 对某个加密货币有基本了解，并形成了自己的价格判断（如关键支撑/阻力位）。
- 清楚自己计划投入的本金（保证金）以及愿意承担的最大亏损比例。
- 对合约杠杆的概念有所了解，但不知道如何根据自己的交易策略和风险偏好来选择最合适的杠杆倍数。
- 常常陷入“高杠杆迷思”，优先考虑能开多大杠杆，而不是优先考虑风险控制。

### 2. 问题陈述 (Problem Statement)

在当前的合约交易市场中，新手投资者面临一个经典且危险的“三难选择”困境。他们往往希望同时实现三个目标：

1. **理想的止损位置**：基于自己的分析，将止损设置在最合理的技术点位。
2. **固定的亏损上限**：将单笔交易的亏损严格控制在可接受的范围内。
3. **较高的资金效率**：希望使用较高的杠杆来放大潜在收益。

然而，这三者在数学上是互相冲突的。新手往往因为不理解其内在关系，错误地优先追求**高杠杆**，导致计算出的止损位毫无意义，或者在未触及理想止损位前就因保证金不足而提前爆仓。

**核心痛点：** 市场缺乏一个能帮助用户**“反向思考”**的工具。用户需要一个能基于他们**“对市场的判断”**和**“对风险的承诺”**，来反向推算出**“最合理的杠杆倍数”**，并进一步验证该杠杆在**终极市场行情**下的**生存能力**，从而将他们的思考模式从**“杠杆优先”**转变为**“风险优先”**。

**次要痛点：**

- 本工具反向思考的算法是否合理，让 Gemini 扮演一个中立、客观的交易分析助手角色。要求它基于给定的数据，从**盈亏比、止损距离、杠杆水平**等角度，用通俗易懂的语言为用户的交易计划提供一个简短的、教育性质的定性分析。**明确指示模型不提供直接的投资建议。**
- 对于高阶用户： 他们可以使用自己的的 API Key 来获得更稳定、无中断的 AI 分析体验。

### 3. 产品目标与价值

- **核心目标**：帮助用户计算出在满足其自定义的止损策略和风险容忍度下的**最优杠杆倍数**，并评估该策略的**健康度**。
- **用户价值**：
  - **风险教育**：通过可视化的计算结果，直观地教育用户杠杆、止损、仓位和风险之间的关系。
  - **策略验证**：让用户在开仓前就能验证自己的交易计划是否可行，避免因错误的参数设置导致不必要的损失。
  - **提升信心**：为新手提供一套清晰、理性的决策框架，帮助他们更有信心地执行交易。
- **商业价值**：作为一款实用工具，可以为交易所、行情分析平台或 KOL 吸引并留存注重风险管理的用户。

### 4. 功能需求 (Features & Functionality)

#### 4.1 计算器核心功能

**用户输入项 (Inputs):**

| **字段名称**        | **字段类型** | **描述/示例**                                                                 | **备注**                 |
| ------------------- | ------------ | ----------------------------------------------------------------------------- | ------------------------ |
| **交易方向**        | 单选按钮     | 做多 (Long) / 做空 (Short)                                                    | 必填                     |
| **开仓价格**        | 数字输入框   | 用户计划入场的市场价格                                                        | 必填                     |
| **止损价格**        | 数字输入框   | 用户基于分析设定的止损价格                                                    | 必填                     |
| **投入本金**        | 数字输入框   | 用户计划投入的保证金 (Margin)                                                 | 必填                     |
| **可亏损比例**      | 滑块/输入框  | 用户愿意承担的最大亏损占本金的百分比                                          | 必填                     |
| **关键阻力/支撑位** | 数字输入框   | **(动态标签)** 根据交易方向显示。做空时为“关键阻力位”，做多时为“关键支撑位”。 | (可选) 但强烈建议填写    |
| **止盈价格**        | 数字输入框   | (可选) 用户计划的盈利目标价格                                                 | 用于计算盈亏比和预估盈利 |

**计算结果输出项 (Outputs):**

| **字段名称**             | **描述**                                                            | **优先级** |
| ------------------------ | ------------------------------------------------------------------- | ---------- |
| **🥇 建议的最大杠杆**    | **核心输出**。基于以上输入计算出的最优杠杆倍数。                    | 最高       |
| **📊 策略健康度分析**    | 基于“预估强平价格”和“关键阻力/支撑位”的对比分析，给出策略风险评级。 | 最高       |
| **仓位价值 (USDT)**      | `投入本金 × 建议杠杆`，用户在市场上的实际头寸大小。                 | 高         |
| **可开仓数量 (币)**      | `仓位价值 / 开仓价格`，用户实际持有的代币数量。                     | 高         |
| **预估亏损金额**         | `投入本金 × 可亏损比例`，验证计算结果符合用户预期。                 | 高         |
| **预估盈利金额**         | 基于止盈价格计算出的潜在盈利金额 (USDT)。仅在输入止盈价后显示。     | 中         |
| **预估强平价格**         | 基于计算出的杠杆倍数，预估的爆仓价格，用于风险警示。                | 中         |
| **盈亏比 (Risk/Reward)** | `(开仓价-止盈价) / (止损价-开仓价)`，仅在输入止盈价后显示。         | 中         |

#### 4.2 AI 增强功能

- **功能名称:** ✨ AI 策略分析 (AI Strategy Analysis)
- **触发方式:** 在计算结果输出区域，提供一个醒目的按钮，例如“✨ AI 分析我的策略”。
- **核心逻辑:**
  1. 用户点击“AI 分析”按钮后，前端收集所有已输入的交易参数和所有已计算出的结果。
  2. 系统优先从浏览器的 `localStorage` 中读取用户自定义的 API Key。如果存在，则使用该 Key；如果不存在，则使用默认的环境变量 Key（即空字符串）。
  3. 前端将这些结构化的数据整合成一个详细的、上下文丰富的 Prompt，连同获取到的 API Key，发送给 Gemini Pro 模型。
  4. **Prompt 设计思路:** 指示 Gemini 扮演一个中立、客观的交易分析助手角色。要求它基于给定的数据，从**盈亏比、止损距离、杠杆水平**等角度，用通俗易懂的语言为用户的交易计划提供一个简短的、教育性质的定性分析。**明确指示模型不提供直接的投资建议。**
  5. 接收 Gemini 生成的文本分析结果。
- ** 🔑 API Key 配置功能:**
  - **UI 元素:** 在“AI 分析我的策略”按钮的右侧，增加一个“设置”或“密钥”图标的按钮。
  - **交互流程:**
    1. 点击该图标按钮，弹出一个简洁的模态框 (Modal)。
    2. 模态框内包含一个标题（如“配置您的 Gemini API Key”）、一个输入框用于粘贴 API Key，以及一个“保存”按钮和一个“关闭”按钮。
    3. 用户在输入框中粘贴自己的 Key 后，点击“保存”。
    4. 系统将该 Key 存储在浏览器的 `localStorage` 中（例如，键名为 `user_gemini_api_key`），以便长期保存。
    5. 保存成功后，模态框自动关闭，并可以给出一个简短的成功提示。
- **交互表现:**
  1. 点击“AI 分析”按钮后，按钮本身变为“分析中...”状态，并显示一个加载动画。
  2. 在下方出现一个新的卡片区域，用于展示 AI 的分析结果，该区域在加载时也显示加载动画。
  3. API 调用成功后，加载动画消失，Gemini 返回的文本以格式化的方式清晰地展示在 AI 分析卡片中。
  4. 如果 API 调用失败（例如，因为无效的 Key），显示一个友好的错误提示，并可以引导用户检查其自定义的 API Key。

#### 4.3 界面与交互 (UI/UX)

- **响应式布局 (Responsive Layout):** 界面需在 PC、平板和移动设备上自适应，确保在不同屏幕尺寸下均有良好的可读性和操作体验。主要内容区域在小屏幕上应由双栏布局自动切换为单栏堆叠布局。
- **页眉与导航 (Header & Navigation):**
  - **社交链接:** 页面右上角应包含两个可点击的图标链接，分别指向 X (Twitter: `x.com/szkane`) 和 GitHub (`github.com/szkane`)。
  - **语言切换:** 提供一个图标按钮，允许用户在中文和英文之间手动切换界面语言。
- **风险提示横幅 (Disclaimer Banner):** 在副标题下方，应有一个视觉突出的黄色提示框，内容为：“合约杠杆交易有风险，本工具仅作学习测试使用。”
- **输入框样式 (Input Styling):**
  - 所有价格相关的输入框应采用“输入组 (Input Group)”样式，在输入框右侧明确标注“USDT”或“$”单位，使用户清晰地了解输入单位。
  - “可亏损比例”的滑块下方，应增加刻度标签，至少包含 `0%`, `20%`, `40%`, `60%`, `80%`, `100%`，以提供更直观的参考。
- **实时计算**：当任何输入项发生变化时，右侧的计算结果应实时更新，无需点击“计算”按钮。
- **交互引导**：
  - 输入框应有清晰的标签和占位符提示。
  - **“关键阻力/支撑位”的标签应根据用户选择的“交易方向”动态切换。**
  - **关键位描述优化:** “关键阻力/支撑位”下方的描述文字优化为：“您的终极防线。用于评估在对手盘‘插针’猎杀止损等极端行情下的生存能力。”
- **输入逻辑验证 (Input Logic Validation):**
  - **目的:** 引导用户设置符合交易逻辑的“止损价格”和“关键位”。
  - **触发时机:** 当“止损价格”和“关键阻力/支撑位”均已输入后进行实时验证。
  - **规则:**
    - **做空时:** 如果 `止损价格 > 关键阻力位`，则触发警告。
    - **做多时:** 如果 `止损价格 < 关键支撑位`，则触发警告。
  - **交互表现:**
    - 在“关键阻力/支撑位”输入框下方，显示一个黄色的、非阻塞的警告提示框。
    - **警告文案 (做空):** “**逻辑建议:** 关键阻力位 (keyLevel)通常应高于您的止损价格({stopLossPrice})。请检查您的战略防线是否设置正确。”
    - **警告文案 (做多):** “**逻辑建议:** 关键支撑位 (keyLevel)通常应低于您的止损价格({stopLossPrice})。请检查您的战略防线是否设置正确。”
    - 当用户修正输入，使之符合逻辑后，警告提示自动消失。
- **AI 分析按钮组:** “AI 分析我的策略”按钮和新增的“API Key 配置”图标按钮应作为一个整体组合出现，保持视觉上的关联性。
- **AI 结果卡片:** 设计一个独特的卡片样式，例如带有渐变边框或特殊的背景色，以区别于常规的计算结果，并明确标注“由 Gemini AI 生成”。
- **策略健康度分析**：
  - 在“建议的最大杠杆”下方，用一个非常直观的模块展示。
  - **安全 (绿色)**: "✅ **策略健康**：您的预估强平价远高于您分析的关键阻力位。此杠杆倍数下，您的策略有足够的安全空间。"
  - **警告 (橙色)**: "⚠️ **值得关注**：您的预估强平价已比较接近您分析的关键阻力位。市场若出现剧烈插针，可能导致策略失效。"
  - **危险 (红色)**: "❌ **策略危险**：您的预估强平价已低于您分析的关键阻力位！这意味着您的仓位会在市场真正考验您的分析之前就被清算。**强烈建议降低杠杆或增加保证金！**"

#### 4.4 国际化 (Internationalization - i18n)

- **支持语言:** 产品需支持简体中文 (zh-CN) 和英文 (en)。
- **自动检测:** 首次加载时，系统应自动检测用户的浏览器语言 (`navigator.language`)，并默认显示匹配的语言。若浏览器语言非中文，则默认显示英文。
- **手动切换:** 用户可通过点击页眉的语言切换图标，在已支持的语言间循环切换。切换状态应被记忆（例如使用 localStorage），以便用户下次访问时保持选择。
- ** API Key:** 配置模态框内的所有文本元素（标题、按钮等）也需要加入中英文翻译。
- 发送给 Gemini 的 Prompt 也应根据当前界面语言进行切换，以确保返回的分析结果语言与用户界面保持一致。
